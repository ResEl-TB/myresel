'use strict';function overflows(a){return a.scrollWidth>a.offsetWidth||parseFloat(window.getComputedStyle(a).width)>parseFloat(window.getComputedStyle(a.parentNode).width)}function formatTime(a,b){var c='';return 10>a&&(c+='0'),c+=a+':',10>b&&(c+='0'),c+b}function displayDuration(a,b,c){if(!a||!b)return'Indisponible';var f=Math.floor((b-a)/3600),g=Math.floor((b-a)/60)%60,h='';return c?formatTime(f,g):(f&&(h+=f+' h',g&&(h+=' ')),g&&(h+=g+' min'),h)}function displayTime(a){var b=new Date(1e3*a);return formatTime(b.getHours(),b.getMinutes())}function displayRange(a,b){return b?'De '+displayTime(a)+' \xE0 '+displayTime(b):'Dur\xE9e ind\xE9termin\xE9e'}function ajaxGet(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){try{var f=JSON.parse(c.responseText)}catch(g){return void console.log(g.message+' in '+c.responseText)}b(f)}},c.open('GET',a,!0),c.send()}var body=document.body;function fullScreen(){var a=body||document.documentElement;document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}function Program(a,b,c,f,g){this.title=a,this.subtitle=b,this.start=c,this.stop=f,this.desc=g}function Channel(a,b,c){this.lcn=a,this.sid=b,this.programs=c}function ResElTV(a,b){var c=this;c.d=a,c.w=b,c.loadingDiv=a.getElementById('loading'),c.videoDiv=a.getElementById('video'),c.channelsDiv=a.getElementById('channels'),c.interacting=0,c.state=0,c.mouseTimer=null,c.cursorVisible=!0,c.channels=[],c.volume=100,c.previousVolume=100,c.playing=!0,c.init=!1,c.player=dashjs.MediaPlayer().create(),c.player.initialize(c.videoDiv.querySelector('video')),c.updateOverlay=function(f){var g=c.d.getElementById('overlay-title');g.innerHTML=f.channelDiv.querySelector('.program-title').innerHTML,c.d.getElementById('overlay-subtitle').innerHTML=f.channelDiv.querySelector('.subtitle').innerHTML,c.d.getElementById('overlay-description').innerHTML=f.channelDiv.querySelector('.description p').innerHTML,c.d.getElementById('overlay-time').innerHTML=f.channelDiv.querySelector('.time').innerHTML,c.d.getElementById('overlay-progress').style.width=f.channelDiv.querySelector('.progress').style.width,c.d.getElementById('duration-indicator').innerHTML=displayDuration(f.currentProgram.start,c.currentTime,!0)+' / '+displayDuration(f.currentProgram.start,f.currentProgram.stop,!0),overflows(g)?g.classList.add('overflow'):g.classList.remove('overflow')},c.switchChannel=function(f){return function(){if(c.d.body.classList.remove('expanded'),c.init&&c.currentChannel.channelDiv.classList.remove('active'),f.channelDiv.classList.remove('selected'),f.channelDiv.classList.add('active'),c.currentChannel=f,c.state){var g=f.channelDiv.getBoundingClientRect();c.channelsDiv.scrollLeft=g.x+(g.width-c.channelsDiv.clientWidth)*c.scrollRatio-parseFloat(c.w.getComputedStyle(f.channelDiv).marginRight)}c.state=0,c.player.attachSource('https://tnt.resel.fr/play/dash/'+f.sid+'/index.mpd'),c.init&&c.updateOverlay(f),c.w.dispatchEvent(new Event('update'))}},c.expand=function(f){return function(g){if(g.stopPropagation(),c.state){c.d.body.classList.remove('expanded'),f.channelDiv.querySelector('.channel-more').style.visibility='hidden',setTimeout(function(){f.channelDiv.querySelector('.channel-more').style.visibility=''},200),f.channelDiv.classList.remove('selected'),c.state=0;for(var k,h=c.channelsDiv.children,m=0;m<h.length;m++)k=h[m].querySelector('.program-title'),overflows(k)?h[m].classList.add('overflow'):h[m].classList.remove('overflow');var l=f.channelDiv.getBoundingClientRect();c.channelsDiv.scrollLeft=l.x+(l.width-c.channelsDiv.clientWidth)*c.scrollRatio-parseFloat(c.w.getComputedStyle(f.channelDiv).marginRight)}else{var l=f.channelDiv.getBoundingClientRect();c.scrollRatio=l.x/(c.channelsDiv.clientWidth-l.width+2*parseFloat(c.w.getComputedStyle(f.channelDiv).marginRight)),c.d.body.classList.add('expanded'),f.channelDiv.classList.add('selected'),overflows(f.channelDiv.querySelector('.program-title'))?f.channelDiv.classList.add('expoverflow'):f.channelDiv.classList.remove('expoverflow'),c.state=1,f.channelDiv.querySelector('.content-y').scrollTop=0}c.w.dispatchEvent(new Event('update'))}},c.fullscreen=function(){c.mouseTimer=null,c.d.body.className='fullscreen',c.state=2},c.updateVolume=function(f){return function(){c.volume=f.value,c.d.querySelector('video').volume=f.value/100,c.d.getElementById('volume1').classList.add('hidden'),c.d.getElementById('volume2').classList.add('hidden'),0<f.value&&(c.d.getElementById('volume1').classList.remove('hidden'),50<=f.value&&c.d.getElementById('volume2').classList.remove('hidden'))}},c.switchVolume=function(){var f=c.d.getElementById('volume');0<c.volume?(c.previousVolume=c.volume,f.value=0):(c.volume=c.previousVolume,f.value=c.volume),c.updateVolume(f)()},c.playPause=function(f){c.playing?(c.player.pause(),c.playing=!1,f.classList.add('paused')):(c.player.play(),c.playing=!0,f.classList.remove('paused'))},c.update=function(){c.currentTime=Math.round(new Date().getTime()/1e3);for(var g,f=c.channels.length,m=0;m<f;m++){if(g=c.channels[m],!g.currentProgram||c.currentTime>=g.currentProgram.stop){for(var k,h=g.programs.length,n=0;n<h;n++)if(k=g.programs[n],k.start<=c.currentTime&&c.currentTime<k.stop){g.currentProgram=k;break}g.currentProgram||(g.currentProgram=new Program);var l=g.channelDiv.querySelector('.program-title');l.innerHTML=g.currentProgram.title||'Indisponible',g.channelDiv.querySelector('.duration').innerHTML=displayDuration(g.currentProgram.start,g.currentProgram.stop),g.channelDiv.querySelector('.subtitle').innerHTML=g.currentProgram.subtitle||'Indisponible',g.channelDiv.querySelector('.time').innerHTML=displayRange(g.currentProgram.start,g.currentProgram.stop),g.channelDiv.querySelector('.description p').innerHTML=g.currentProgram.desc||'Indisponible',g.channelDiv.onclick=c.switchChannel(g),overflows(l)?g.channelDiv.classList.add('overflow'):g.channelDiv.classList.remove('overflow')}g.channelDiv.querySelector('.progress').style.width=(g.currentProgram.start?Math.round(100*(c.currentTime-g.currentProgram.start)/(g.currentProgram.stop-g.currentProgram.start)):0)+'%',c.updateOverlay(c.currentChannel),c.w.dispatchEvent(new Event('update'))}},ajaxGet('https://tnt.resel.fr/data.json',function(f){for(var g in ScrollBarX.initEl(c.channelsDiv),c.channelsDiv=c.channelsDiv.firstChild.firstChild,f){var h=new Channel(g,f[g].sid,f[g].programs);c.channelsDiv.insertAdjacentHTML('beforeend','<div tabindex="0" class="channel" data-lcn="'+g+'"><div class="flip"><div class="card"><div class="channel-logo" style="background-image: url(\''+h.sid+'.png\');"></div><div class="channel-more"><div class="more-button"></div></div></div></div><div class="program"><div class="program-title"></div><div class="progressbar"><div class="progress"></div></div><div class="duration"></div></div><div class="middle"><div class="subtitle"></div><div class="time"></div></div><div class="right"><div class="description"><p></p></div></div></div>'),h.channelDiv=c.channelsDiv.lastChild,h.channelDiv.onclick=c.switchChannel(h),h.channelDiv.querySelector('.description').onclick=function(n){n.stopPropagation()},h.channelDiv.querySelector('.channel-more').onclick=c.expand(h),ScrollBarY.initEl(h.channelDiv.querySelector('.description')),c.channels.push(h)}c.switchChannel(c.channels[0])(),c.init=!0,c.update(),c.channelsDiv.onmouseover=function(){c.interacting=1},c.channelsDiv.onmouseout=function(){c.interacting=0},c.d.getElementById('videobar').onmouseover=function(){c.interacting=1},c.d.getElementById('videobar').onmouseout=function(){c.interacting=0};var k=function(){c.mouseTimer&&c.w.clearTimeout(c.mouseTimer),2==c.state&&(c.d.body.className='',c.state=0),0==c.state+c.interacting&&(c.mouseTimer=c.w.setTimeout(c.fullscreen,2500))};c.d.onmousemove=k,c.d.onmouseup=k,c.d.onmousedown=k;var l=c.d.getElementById('play-pause');l.onclick=function(){c.playPause(l)};var m=c.d.getElementById('volume');m.oninput=c.updateVolume(m),m.onchange=c.updateVolume(m),m.onmousedown=function(){0<m.value&&(c.previousVolume=m.value)},c.d.getElementById('sound').onclick=function(){c.switchVolume()},c.d.getElementById('fullscreen').onclick=function(){fullScreen()},c.loadingDiv.classList.add('done'),setTimeout(function(){c.d.body.removeChild(c.loadingDiv)},1e3),setInterval(c.update,1e4)})}