{% extends 'base.html' %}
{% load i18n %}

{% block titre %}{%  trans "Inscription" %}{% endblock %}

{% block content %}
    <div class="container">
        <h1 class="page-header">{% trans "Inscription au ResEl" %}</h1>
        <div class="alert alert-warning">{% trans "Vous êtes sur le point de créer un compte Resel, si vous en avez déjà un veuillez vous" %} <a href="{% url "login" %}">{% trans "connecter" %}</a>.</div>
        <div class="col-md-8">
            <form action="" method="POST" class="form">
                {% csrf_token %}
                <div class="form-category">
                    <p>{% trans "Veuillez renseigner vos informations personnelles" %}</p>
                    <div class="row">
                        <fieldset class="form-group col-sm-6 {% if form.last_name.errors %}has-error{% endif %}" >
                            {{ form.last_name }}
                            {% if form.last_name.errors %}<span class="help-block">{{ form.last_name.errors }}</span>{% endif %}
                        </fieldset>

                        <fieldset class="form-group col-sm-6 {% if form.first_name.errors %}has-error{% endif %}">
                            {{ form.first_name }}
                            {% if form.first_name.errors %}<span class="help-block">{{ form.first_name.errors }}</span>{% endif %}
                        </fieldset>

                        <fieldset class="form-group col-sm-6 {% if form.formation.errors %}has-error{% endif %}">
                            {{ form.formation }}
                            {% if form.formation.errors %}<span class="help-block">{{ form.formation.errors }}</span>{% endif %}
                        </fieldset>
                    </div>
                </div>

                <div class="form-category">
                    <p>{% trans "Veuillez renseigner vos informations de compte" %}</p>

                    <div class="row">
                        <fieldset class="form-group col-sm-6 {% if form.email.errors %}has-error{% endif %}">
                            {{ form.email }}
                            {% if form.email.errors %}<span class="help-block">{{ form.email.errors }}</span>{% endif %}
                        </fieldset>
                    </div>

                    <div class="row">
                        <fieldset class="form-group col-sm-6 {% if form.password.errors %}has-error{% endif %}">
                            {{ form.password }}
                            {% if form.password.errors %}<span class="help-block">{{ form.password.errors }}</span>{% endif %}
                        </fieldset>
                        <fieldset class="form-group col-sm-6 {% if form.password_verification.errors %}has-error{% endif %}">
                            {{ form.password_verification }}
                            {% if form.password_verification.errors %}<span class="help-block">{{ form.password_verification.errors }}</span>{% endif %}
                        </fieldset>
                    </div>
                </div>

                <div class="form-category">
                    <p>{% trans "Nous avons de besoin de votre numéro de bâtiment, votre numéro de chambre et votre numéro de téléphone afin de vous contacter" %}</p>
                    <div class="row">
                    <fieldset class="form-group col-sm-6 {% if form.campus.errors %}has-error{% endif %}">
                            {{ form.campus }}
                            {% if form.campus.errors %}<span class="help-block">{{ form.campus.errors }}</span>{% endif %}
                    </fieldset>
                    </div>
                    <div class="row" id="maisel-information">
                        <fieldset class="form-group col-sm-6 {% if form.building.errors %}has-error{% endif %}">
                            {{ form.building }}
                            {% if form.building.errors %}<span class="help-block">{{ form.building.errors }}</span>{% endif %}
                        </fieldset>
                        <fieldset class="form-group col-sm-6 {% if form.room.errors %}has-error{% endif %}">
                            {{ form.room }}
                            {% if form.room.errors %}<span class="help-block">{{ form.room.errors }}</span>{% endif %}
                        </fieldset>
                    </div>
                    <div class="row" id="home-address">
                        <fieldset class="form-group col-sm-6 {% if form.address.errors %}has-error{% endif %}">
                            {{ form.address }}
                            {% if form.address.errors %}<span class="help-block">{{ form.address.errors }}</span>{% endif %}
                        </fieldset>
                    </div>

                    <div class="row">
                        <fieldset class="form-group col-sm-6 {% if form.phone.errors %}has-error{% endif %}">
                            {{ form.phone }}
                            {% if form.phone.errors %}<span class="help-block">{{ form.phone.errors }}</span>{% endif %}
                        </fieldset>
                    </div>
                </div>

                <div class="form-category">
                    <div class="row">
                        <fieldset class="checkbox form-group col-sm-10 col-sm-offset-2 {% if form.certify_truth.errors %}has-error{% endif %}">
                            {{ form.certify_truth }}{{ form.certify_truth.label_tag }}
                        </fieldset>
                    </div>
                </div>

                <div class="form-category">
                    <div class="row">
                        <div class="text-center">
                            <button type="submit" class="btn btn-info">{% trans "Créer un compte" %}</button>
                        </div>
                    </div> <!-- /.row -->
                </div>
            </form>
        </div> <!-- /.container -->
{% endblock %}

{% block javascript %}
    <script>
        var brest_buildings = ['I1', 'I2', 'I3', 'I4', 'I5', 'I6', 'I7', 'I8', 'I9', 'I10', 'I11', 'I12'];
        var rennes_buildings = ['Studios', 'Chambres'];

        function update_buildings() {
            var selected_campus = $("#id_campus").find("option:selected").text();
            if (selected_campus === "Brest") {
                $("#maisel-information").show();
                $("#home-address").hide();
                $("#id_building").find("option").each(function () {
                    if(brest_buildings.indexOf($(this).text()) >= 0){
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                })
            } else if (selected_campus === "Rennes") {
                $("#maisel-information").show();
                $("#home-address").hide();
                $("#id_building").find("option").each(function () {
                    if(rennes_buildings.indexOf($(this).text()) >= 0){
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                })
            } else {
                $("#maisel-information").hide();
                $("#home-address").show();
            }
        }

        $("#id_campus").on("change", function (event) {
            update_buildings();
        });

        $( document ).on("ready", function( event ){
            update_buildings();
        });
    </script>
{% endblock %}