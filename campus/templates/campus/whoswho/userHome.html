{% extends "base_campus.html" %}
{% load i18n %}
{% load staticfiles %}

{% block title %} WhosWho {% endblock %}

{% block css %}
<link href="{% static 'css/campus/whoswho.css' %}" rel="stylesheet">
<link href="{% static 'jquery/jquery-ui.min.css' %}" rel="Stylesheet"></link>
{% endblock %}

{% block content %}
<div class="container">
   <div class="row">
      <div class="col-md-12">
         <div class="page-header text-center">
            <img class="who_logo" src="{% static 'images/campus/whoswho_logo.png'%}">
         </div>
      </div>
   </div>
</div>

<div class="container">
   <div class="row">
      <div class="col-md-6">
         <div class="col-md-12 well test">
            <div class="user-form">
               <a href="#collapse-form" data-toggle="collapse" class="edit-info-link">
                  <span class="fa fa-pencil-square-o"></span> Éditer
               </a>
               <div class="collapse" id="collapse-form">
                  <form action="" method="post" class="form form-horizontal">
                     {% csrf_token %}
                     <h3 class="text-center">Éditer mes informations</h3>
                     <div class="form-group">
                        <label for="uid" class="col-sm-3 control-label">{% trans "Nom" %}</label>
                        <div class="col-sm-8">
                           <input type="text" class="form-control" id="uid" placeholder="{% trans "Nom" %}" value="{{ user.last_name }}" disabled="disabled">
                        </div>
                     </div>
                     <div class="form-group">
                        <label for="uid" class="col-sm-3 control-label">{% trans "Prenom" %}</label>
                        <div class="col-sm-8">
                           <input type="text" class="form-control" id="uid" placeholder="{% trans "Nom" %}" value="{{ user.first_name }}" disabled="disabled">
                        </div>
                     </div>
                     <!-- Changer pour un form django ! -->
                     <div class="form-group">
                        <label for="uid" class="col-sm-3 control-label">{% trans "Email" %}</label>
                        <div class="col-sm-8">
                           {{form.mail.errors}}
                           {{form.mail}}
                        </div>
                     </div>
                     <div class="form-category">
                        <div class="col-sm-offset-3 col-sm-8">
                           {{form.show_email}} {{form.show_email.label_tag}}
                        </div>
                     </div>
                     <div class="form-group">
                        <label for="uid" class="col-sm-3 control-label">{% trans "Campus" %}</label>
                        <div class="col-sm-8">
                           {{form.campus.errors}}
                           {{form.campus}}
                        </div>
                     </div>
                     <span id="maisel-information">
                        <div class="form-group">
                           <label for="uid" class="col-sm-3 control-label">{% trans "Batiment" %}</label>
                           <div class="col-sm-8">
                              {{ form.building.errors }}
                              {{form.building}}
                           </div>
                        </div>
                        <div class="form-group">
                           <label for="uid" class="col-sm-3 control-label">{% trans "Chambre" %}</label>
                           <div class="col-sm-8">
                              {{form.room_number.errors}}
                              {{form.room_number}}
                           </div>
                        </div>
                     </span>
                     <div class="form-group" id="home-address">
                        <label for="uid" class="col-sm-3 control-label">{% trans "Adresse" %}</label>
                        <div class="col-sm-8">
                           {{form.address.errors}}
                           {{form.address}}
                        </div>
                     </div>
                     <div class="form-category">
                        <div class="col-sm-offset-3 col-sm-8">
                           {{form.show_room}} {{form.show_room.label_tag}}
                        </div>
                    </div>
                     <div class="form-category">
                        <div class="row">
                            <div class="text-center">
                                <button type="submit" class="btn btn-lg btn-success">{% trans "Valider ces informations" %}</button>
                            </div>
                        </div>
                    </div>
                  </form>
               </div>
            </div>
            <h3 class="text-center">Mon Profil</h3>
            <p class="text-center">
               {{user.first_name}} {{user.last_name}}, {{user.formation}} promo {{user.promo}} <br>
               <a href="mailto:{{user.mail}}">{{user.mail}}</a><br>
               {% if user.campus != "None" %}
                  Campus de {{user.campus}}<br>
                  Batiment {{user.building}} Chambre {{user.room_number}}
               {% else %}
                  Ne réside pas à la Maisel <br>
                  {{ user.postal_address }}
               {% endif %}
            </p>
         </div>
      </div>
      <div class="col-md-4 col-md-offset-1">
         <div class="col-md-12 well">
            <h3 class="text-center" >Rechercher quelqu'un</h3>
            <form class="form-horizontal" action="{% url 'campus:who:search-user' %}" method="post">
               {% csrf_token %}
               <div class="input-group" style="width:100%">
                  <span class="input-group-addon" id="basic-addon1"><span class="fa fa-user"></span></span>
                  {{ formSearchUser.what.errors }}
                  {{ formSearchUser.what }}
               </div>
               {{ formSearchUser.is_approx.errors }}
               {{ formSearchUser.is_approx }} {{ formSearchUser.is_approx.label_tag }}
               <div>
                  Vous pouvez rechercher:
                  <ul>
                     <li>Un nom</li>
                     <li>Un prenom</li>
                     <li>Une adresse email</li>
                  </ul>
               </div>
               <div class="form-group text-center">
                  <div class="btn-group" role="button" aria-label="submit">
                     <button type="submit" class="btn btn-success">C'est parti !</button>
                  </div>
               </div>
            </form>
         </div>
      </div>
   </div>
</div>
{% endblock %}

{% block javascript %}
    <script>
        var brest_buildings = ['I1', 'I2', 'I3', 'I4', 'I5', 'I6', 'I7', 'I8', 'I9', 'I10', 'I11', 'I12'];
        var rennes_buildings = ['Studios', 'Chambres'];

        function update_buildings() {
            var selected_campus = $("#id_campus").find("option:selected").text();
            if (selected_campus === "Brest") {
                $("#maisel-information").show();
                $("#home-address").hide();
                $("#id_building").find("option").each(function () {
                    if(brest_buildings.indexOf($(this).text()) >= 0){
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                })
            } else if (selected_campus === "Rennes") {
                $("#maisel-information").show();
                $("#home-address").hide();
                $("#id_building").find("option").each(function () {
                    if(rennes_buildings.indexOf($(this).text()) >= 0){
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                })
            } else {
                $("#maisel-information").hide();
                $("#home-address").show();
            }
        }

        $("#id_campus").on("change", function (event) {
            update_buildings();
        });

        $( document ).on("ready", function( event ){
            update_buildings();
        });
    </script>
{% endblock %}
