{% extends "base_campus.html" %}
{% load staticfiles %}
{% load i18n %}

{% block title %}Associations et clubs{% endblock %}
{% block css %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/campus/clubs.css' %}">
    <link href="{% static 'jquery/jquery-ui.min.css' %}" rel="Stylesheet"></link>
{% endblock %}
{% block content %}

<div class="container">
    <div class="row">
        <div class="col-md-12 well">
          <h2>{% trans 'Assos' %}</h2>
            {% for asso in assos %}
            <div class="row assos-card">
                <div class="col-md-3 col-md-offset-1">
                  {% if asso.logo %}
                  <img class="assos-img" src="/media/image/ASSOS/{{ asso.logo }}">
                  {% endif %}
                </div>
                <div class="col-md-5">
                    <h2>{{ asso.name }}</h2>
                    <p>{{ asso.description }}</p>
                    {% if asso.email %}
                    <p>Mailing list: <a href="mailto:{{ asso.email }}">{{ asso.email}}</a></p>
                    {% endif %}
                    {% if asso.website %}
                    <p><a href="http://{{ asso.website }}">En savoir plus</a></p>
                    {% endif %}
                </div>
                <div class="col-md-3">
                    {% if request.user.is_authenticated %}
                    <p>Actions:</p>
                    <p><a href="{% url 'campus:clubs:edit' asso.cn%}"><span class="fa fa-edit"></span> éditer</a></p>
                    {% endif %}
                </div>
            </div>
            {% empty%}
            {% trans "Une erreur est servenue pendant la récupération des assos" %}
            {% endfor %}
        </div>
    </div>
    <div class="row">
        <div class="col-md-12 well">
            <h2>{% trans 'Clubs' %}</h2>
            {% for club in clubs %}
            <div class="row assos-card">
                <div class="col-md-8 col-md-offset-1">
                    <h2>{{ club.name }}</h2>
                    <p>{{ club.description }}</p>
                    {% if club.website %}
                    <p>Mailing list: <a href="mailto:{{ club.email }}">{{ club.email}}</a></p>
                    {% endif %}
                    {% if club.website %}
                    <p><a href="http://{{ club.website }}">En savoir plus</a></p>
                    {% endif %}
                </div>
                <!-- TODO: colapse -->
                <div class="col-md-3">
                    {% if request.user.is_authenticated %}
                    <p>Actions:</p>
                    <p><a href="{% url 'campus:clubs:edit' club.cn%}"><span class="fa fa-edit"></span> éditer</a></p>
                    {% if not 'uid='|add:request.ldap_user.uid|add:','|add:ldapOuPeople in club.members%}
                    <p><a href="{% url 'campus:clubs:add-person' club.cn%}"><span class="fa fa-sign-in"></span> m'inscrire</a></p>
                    {% else %}
                    <p><a href="{% url 'campus:clubs:remove-person' club.cn%}"><span class="fa fa-sign-out"></span> me désinscrire</a></p>
                    {% endif %}
                    {% if request.ldap_user.is_campus_moderator %}
                    <p><a class="addPersonLink" data-toggle="modal" data-target="#addPerson" data="{{club.cn}}"><span class="fa fa-user-plus"></span> inscrire un membre</a></p>
                    <p><a class="delPersonLink" data-toggle="modal" data-target="#delPerson" data="{{club.cn}}"><span class="fa fa-user-times"></span> désinscrire un membre</a></p>
                    {% endif%}
                    {% endif %}
                </div>
            </div>
            {% empty %}
            {% trans "Une erreur est servenue pendant la récupération des clubs" %}
            {% endfor %}
        </div>
    </div>
    <!--
    <div class="row">
        <div class="col-md-12 well">
            <h2>{% trans 'Listes' %}</h2>
            {% for list in lists %}
            <div class="row assos-card">
                <div class="col-md-3 col-md-offset-1">
                    {% if list.logo %}
                    <img class="assos-img" src="/media/image/LIST/{{ list.logo }}">
                    {% endif %}
                </div>
                <div class="col-md-5">
                    <h2>{{ list.name }}</h2>
                    <p>{{ list.description }}</p>
                    <p>Année de campagne: {{ list.campagneYear }}</p>
                    {% if list.website %}
                    <p>Mailing list: <a href="mailto:{{ list.email }}">{{ list.email}}</a></p>
                    {% endif %}
                    {% if list.website %}
                    <p><a href="http://{{ list.website }}">En savoir plus</a></p>
                    {% endif %}
                </div>
                <div class="col-md-3">
                    {% if request.user.is_authenticated %}
                    <p>Actions:</p>
                    <p><a href="{% url 'campus:clubs:edit' list.cn%}"><span class="fa fa-edit"></span> éditer</a></p>
                    {% endif %}
                </div>
            </div>
            {% empty %}
            {% trans "Une erreur est servenue pendant la récupération des listes" %}
            {% endfor %}
        </div>
    </div>
    -->
</div>
{% if request.ldap_user.is_campus_moderator %}
<div class="modal fade" id="addPerson" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <form class="form-horizontal" id="addPersonForm" action="" method="get">
                {% csrf_token %}
                <div class="modal-header">
                    <h4 class="modal-title">{% trans "Ajouter une Personne" %}</h4>
                </div>
                <div class="modal-body">
                  <p>{% trans "Entrer la personne à ajouter à ce club:" %}</p>
                  <div class="input-group">
                    <span class="input-group-addon" id="basic-addon1"><span class="fa fa-user"></span></span>
                    <input type="text" class="form-control" name="id_user" id="id_user_to_add" style="width:70%;"></input>
                  </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">{% trans "Ajouter" %}</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "Annuler" %}</button>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="modal fade" id="delPerson" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <form class="form-horizontal" id="delPersonForm" action="" method="get">
                {% csrf_token %}
                <div class="modal-header">
                    <h4 class="modal-title">{% trans "Désinscrire une personne" %}</h4>
                </div>
                <div class="modal-body">
                  <p>{% trans "Entrer la personne à ajouter à désinscrire de ce club:" %}</p>
                  <div class="input-group">
                    <span class="input-group-addon" id="basic-addon1"><span class="fa fa-user"></span></span>
                    <input type="text" class="form-control" name="id_user" id="id_user_to_del" style="width:70%;"></input>
                  </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">{% trans "Ajouter" %}</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "Annuler" %}</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block javascript %}
<script src="{% static 'jquery/jquery-ui.min.js' %}"></script>
<script>
    var addlinks = document.getElementsByClassName('addPersonLink');
    var dellinks = document.getElementsByClassName('delPersonLink');
    var addform = document.getElementById('addPersonForm');
    var delform = document.getElementById('delPersonForm');

    for (var i = 0; i < addlinks.length; i++) {
        addlinks[i].addEventListener("click", changeAddLinkValue(i));
    };

    for (var i = 0; i < dellinks.length; i++) {
        dellinks[i].addEventListener("click", changeDelLinkValue(i));
    };


    function changeAddLinkValue(i) {
    return function(){
        addform.action = "{{hardLinkAdd}}"+addlinks[i].getAttribute('data');
        };
    };

    function changeDelLinkValue(i) {
    return function(){
        delform.action = "{{hardLinkDel}}"+dellinks[i].getAttribute('data');
        };
    };

</script>
<script>
    jQuery(document).ready(function ($) {
      $('#id_user_to_add').autocomplete({
          source: "{% url 'campus:who:request-user' %}",
          minLength: 3,
      });
    })

    jQuery(document).ready(function ($) {
      $('#id_user_to_del').autocomplete({
          source: "{% url 'campus:who:request-user' %}",
          minLength: 3,
      });
    })
</script>
{% endblock %}
