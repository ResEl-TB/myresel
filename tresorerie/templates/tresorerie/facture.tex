%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Copyright Association ResEl - LICENSE MIT
%
% This document is a latex template of invoice, generated by the association
% ResEl, for its members.
%
% This template use an improved version of invoice latex template
% of Trey Hunner (https://github.com/treyhunner/invoices)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%
% TO EDIT THE TEMPLATE, GO TO LINE ~115 
%%%%%

%--------------------------------------------------- Package includes & config
\documentclass[12pt]{article}
\usepackage[utf8]{inputenc}

\usepackage[T1]{fontenc}
\usepackage[francais]{babel}
\usepackage{lmodern}
\usepackage{eurosym}

\usepackage[letterpaper,hmargin=0.79in,vmargin=0.79in]{geometry}
\usepackage[parfill]{parskip} % Do not indent paragraphs
\usepackage{fp} % Fixed-point arithmetic
\usepackage{calc} % Counters for totaling hours and cost
\usepackage{longtable}
\usepackage{ifthen}

\pagestyle{empty} % No page numbers
\linespread{1.5}

\setlength{\doublerulesep}{\arrayrulewidth} % Double rules look like one thick one

%--------------------------------------------------- Invoice command & env definitions
% Command for setting a default hourly rate
\newcommand{\hourlyrate}[1]{\def \@hourlyrate {#1}}
\hourlyrate{1}
\newcommand{\feetype}[1]{
    \textbf{#1}
    \\
}

% Counters for totaling up hours and dollars
\newcounter{hours} \newcounter{subhours} \newcounter{cost} \newcounter{subcost}
\setcounter{hours}{0} \setcounter{subhours}{0} \setcounter{cost}{0} \setcounter{subcost}{0}

% Formats inputed number with 2 digits after the decimal place
\newcommand*{\formatNumber}[1]{\FPround{\cost}{#1}{2}\cost} %

% Returns the total of counter
\newcommand*{\total}[1]{\FPdiv{\t}{\arabic{#1}}{1000}\formatNumber{\t}}

% Create an invoice table
\newenvironment{invoiceTable}[1]{
	\def\fooNoI{#1} % Store language for end block
    % Create a new row : title, unit quantity, unit rate, and unit name
    \newcommand*{\unitrow}[4]{%
         \addtocounter{cost}{1000 * \real{##2} * \real{##3}}%
         \addtocounter{subcost}{1000 * \real{##2} * \real{##3}}%
         ##1 & ##2 ##4 & \formatNumber{##3}\euro & \FPmul{\cost}{##2}{##3}\formatNumber{\cost}\euro%
         \\
    }
    % Create a new row from title and expense amount
    \newcommand*{\feerow}[2]{%
         \addtocounter{cost}{1000 * \real{##2}}%
         \addtocounter{subcost}{1000 * \real{##2}}%
         ##1 & & \formatNumber{##2}\euro & \FPmul{\cost}{##2}{1}\formatNumber{\cost}\euro%
         \\
    }

    \newcommand{\subtotalNoStar}{
        {\bf Subtotal} & {\bf \total{subhours} hours} &  & {\bf \$\total{subcost}}
        \setcounter{subcost}{0}
        \setcounter{subhours}{0}
        \\*[1.5ex]
    }
    \newcommand{\subtotalStar}{
        {\bf Subtotal} & & & {\bf \total{subcost}\euro}
        \setcounter{subcost}{0}
        \\*[1.5ex]
    }
    \newcommand{\subtotal}{
         \hline
         \@ifstar
         \subtotalStar%
         \subtotalNoStar%
    }


    % Create a new row from date and hours worked (use stored fee type and hourly rate)
    \newcommand*{\hourrow}[2]{%
        \addtocounter{hours}{1000 * \real{##2}}%
        \addtocounter{subhours}{1000 * \real{##2}}%
        \unitrow{##1}{##2}{\@hourlyrate}{hours}%
    }
    \renewcommand{\tabcolsep}{0.8ex}
    \setlength\LTleft{0pt}
    \setlength\LTright{0pt}
    \begin{longtable}{@{\extracolsep{\fill}\hspace{\tabcolsep}} l r r r }
    \hline
    {\bf \ifthenelse{\equal{#1}{en}}{Description}{Désignation}} & \multicolumn{1}{c}{\bf \ifthenelse{\equal{#1}{en}}{Quantity}{Quantité}} & \multicolumn{1}{c}{\bf \ifthenelse{\equal{#1}{en}}{Unit price}{Prix unitaire}} & \multicolumn{1}{c}{\bf \ifthenelse{\equal{#1}{en}}{Amount}{Montant}} \\*
    \hline\hline
    \endhead
}{
    \hline\hline\hline
    {\bf \ifthenelse{\equal{\fooNoI}{en}}{Amount Due}{Montant à payer}} & & & {\bf \total{cost}\euro} \\
    \end{longtable}
}
\def \tab {\hspace*{3ex}}

\begin{document}

%--------------------------------------------------- Beginning of template

{\Huge\bf ResEl}\hfil{\Huge\bf Facture}
\bigskip\break
\hrule

Association ResEl - Télécom Bretagne \hfill (33) 2 29 00 15 76 \\
655, avenue du Technopôle \hfill tresorier@resel.fr \\
29280 Plouzané
France
\\ \\
{\bf \ifthenelse{\equal{\confLang}{en}}{Invoice To}{Délivrée à} :}  {{user.firstName}} {{user.lastName}} \\
\tab {{ user.addressFirstPart }} \\
\tab {{ user.addressSecondPart }}

{\bf Date :}  {{ invoice.date }}

{\bf \ifthenelse{\equal{\confLang}{en}}{Number}{Numéro} :} {{ invoice.id}}

{\bf \ifthenelse{\equal{\confLang}{en}}{Client id}{Code client} :} {{ user.uid }}
\\

%----------------------------------------------------------------------------------------

\begin{invoiceTable}{\confLang}


\feetype{\ifthenelse{\equal{\confLang}{en}}{Membership fee}{Cotisation}}
\unitrow{\ifthenelse{\equal{\confLang}{en}}{Membership fee for one year}{Cotisation à l'association}}{1}{1}{}

%------------------------------------------------

\feetype{Internet}
%title, unit quantity, unit rate, and unit name
\unitrow{\ifthenelse{\equal{\confLang}{en}}{Access fees to Internet for one year}{Frais d'accès à internet pour 1 an}}{1}{ {{ invoice.internetFeesprice }} }{}

%------------------------------------------------

{% if invoice.misc %}
\feetype{\ifthenelse{\equal{\confLang}{en}}{Various}{Divers}}
\unitrow{\ifthenelse{\equal{\confLang}{en}}{Ethernet cable (3m)}{Câble ethernet (3m)}}{1}{2.5}{}
{% endif %}
%------------------------------------------------

\end{invoiceTable}

(TVA non applicable, art. 293 B du CGI )
\\ \\

%----------------------------------------------------------------------------------------

{% if invoice.isPaid %}
{\bf \ifthenelse{\equal{\confLang}{en}}{Paid invoice}{Facture acquitée}:} \\
\tab {{ invoice.payment.date }} \\
\tab {{ invoice.payment.info }}
{% else %}
{\bf \ifthenelse{\equal{\confLang}{en}}{Payment}{Paiement}:} \\
\tab \ifthenelse{\equal{\confLang}{en}}{Payment before}{Paiement avant le} : {{ invoice.payment.date }} \\
\tab \ifthenelse{\equal{\confLang}{en}}{Possible means of payment}{Moyen de paiement possible} : {{ invoice.payment.info }}
{% endif %}
\end{document}